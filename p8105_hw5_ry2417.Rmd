---
title: "p8105_hw5_ry2417"
author: "Ruiqi Yan"
date: "`r format(Sys.time(), '%m/%d/%Y')`"
output: github_document
---

```{r, include = FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d(option = "viridis")
scale_fill_discrete = scale_fill_viridis_d(option = "viridis")
```

## Problem 1

```{r}
homicide_df_raw <- 
  read_csv("data/homicide-data.csv") %>% 
  janitor::clean_names()
```

There are `r homicide_df_raw %>% nrow()` cases of homicide with `r homicide_df_raw %>% ncol()` variables in this data. The variables are `r homicide_df_raw %>% colnames() %>% paste(collapse = ", ")`. There are `r homicide_df_raw %>% count(state) %>% nrow()` states and `r homicide_df_raw %>% count(city) %>% nrow()` cities. The distribution of age and gender of victim shown here: 

```{r age_gender_distribution}
homicide_df_raw %>% 
  filter(victim_age != "Unknown") %>% 
  mutate(victim_age = as.numeric(victim_age)) %>% 
  ggplot(aes(y = victim_age)) +
  geom_bar() +
  facet_grid(. ~ victim_sex) +
  labs(
    x = "number of victim",
    y = "age",
    title = "Age and Gender Distribution of Victims"
  )
```

summarizes within cities to obtain the total number of homicides and 
the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”)
```{r}
homicide_df <- 
  homicide_df_raw %>% 
  mutate(
    state = str_to_upper(state),
    city_state = paste0(city, ", ", state)
  ) %>% 
  select(city_state, everything())
homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    num_homicide = n(),
    num_unsolved = sum(disposition == "Closed without arrest" |
                         disposition == "Open/No arrest")
  ) %>% 
  knitr::kable()
  
```


## Problem 2


```{r}
study_df <- 
  tibble(
    file_names = list.files("data/data", full.names = TRUE)  
  ) %>% 
  mutate(
    observation_data = purrr::map(.x = file_names, ~read_csv(.x)),
    id = str_extract(file_names, pattern = "[[:digit:]]+"),
    arm = str_sub(file_names, start = 11, end = 13)
  ) %>% 
  unnest(observation_data) %>% 
  select(arm, id, everything(), -file_names) %>% 
  pivot_longer(cols = starts_with("week_"),
               names_to = "week",
               names_prefix = "week_",
               values_to = "observations")


```

Some examples of the resulted data frame shown as 
`r study_df %>% head(10) %>% knitr::kable()`

A spaghetti plot showing observations on each subject over time

```{r}
study_df %>% 
  mutate(arm_id = paste(arm, "_", id),
         week = as.numeric(week)) %>% 
  ggplot(aes(x = week, y = observations, group = arm_id, color = arm)) +
  geom_line() +
  labs(
    title = "Observations of Each Subject Over Time(Control vs. Experiment)",
    caption = "Data from a Longitudinal Study"
  ) +
  scale_color_discrete(labels = c("control", "experiment"))
```

The observations of experimental arm is increasingly higher than the observations of control arm over time.
The difference of observations between control arm and experimental arm increases over time.\


## Problem 3

```{r}
set.seed(10)

iris_with_missing <- iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

```{r, echo = TRUE}
replace_missing <- function(input_vector) {
  if (is_numeric(input_vector)) {
    input_vector[is.na(input_vector)] = mean(input_vector, na.rm = TRUE)
  } else {
    input_vector[is.na(input_vector)] = "virginica"
  }
  
  return(input_vector)
}

iris_no_missing <-
  iris_with_missing %>% 
  map(~replace_missing(.x))
```

